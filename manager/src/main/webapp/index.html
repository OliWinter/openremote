<!DOCTYPE html>
<html>
<head>
    <title>OpenRemote Manager</title>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="icon" type="image/png" href="/static/img/favicon.png"/>

    <script src="/static/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <link rel="import" href="/static/bower_components/polymer/polymer.html">

    <link rel="import" href="/static/bower_components/paper-button/paper-button.html">
    <link rel="import" href="/static/bower_components/iron-icon/iron-icon.html">
    <link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="/static/components/ui/or-icons.html">

    <script src="/auth/js/keycloak.min.js"></script>

    <script>
        // TODO
        erraiBusRemoteCommunicationEnabled = false;
        /*
         erraiJaxRsJacksonMarshallingActive = true;
         */

        function init() {
            /*
             var keycloakConfig = {
             url: '/auth',
             realm: window.location.pathname.split('/')[1],
             clientId: "or-manager"
             };
             window.keycloak = Keycloak(keycloakConfig);
             window.keycloak.init({onLoad: 'login-required'})
             .success(function (authenticated) {
             if (authenticated) {
             loadApp();
             } else {
             window.keycloak.login();
             }
             })
             .error(function () {
             alert("Failed to initialize login. Please contact your administrator.");
             });
             */
            loadApp();
        }

        function loadApp() {
            var jsapi = new Promise(function (resolve, reject) {
                loadScript("/jsapi", resolve);
            });

            var mapbox = new Promise(function (resolve, reject) {
                loadStyleSheet("/static/3rdparty/mapbox-gl-js/0.14.1/mapbox-gl.css");
                loadScript("/static/3rdparty/mapbox-gl-js/0.14.1/mapbox-gl.js", resolve);
            });


            var entrypoint = new Promise(function (resolve, reject) {
                loadStyleSheet("/static/css/openremote.css");
                loadScript("/static/gwt/Manager/Manager.nocache.js", resolve);
            });

            Promise.all([
//                jsapi,
//                mapbox,
                entrypoint
            ]).then(function (results) {
                console.log("Application resources loaded successfully")
            });
        }

        function loadStyleSheet(href) {
            var link = document.createElement("link");
            link.href = href;
            link.rel = "stylesheet";
            link.type = "text/css";
            document.getElementsByTagName('head')[0].appendChild(link);
        }

        function loadScript(src, onload) {
            var script = document.createElement("script");
            script.src = src;
            script.onload = onload;
            document.getElementsByTagName('head')[0].appendChild(script);
        }
    </script>

</head>
<body onload="init()" class="vbox viewport">

<iframe src="javascript:''"
        id="__gwt_historyFrame"
        style="position:absolute;width:0;height:0;border:0"></iframe>

<noscript>
    <div style="border: 1px solid red;">
        Your web browser must have JavaScript enabled
        in order for this application to display correctly.
    </div>
</noscript>

</body>
</html>